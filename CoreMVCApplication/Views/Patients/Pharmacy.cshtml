@model CoreMVCApplication.Models.NewPharmacyRequest
@{
    ViewData["Title"] = "Pharmacy";
    Layout = "~/Views/Shared/_GlobalLawLayout.cshtml";
}
<html>
<head>
    <style>
        .modal-body .form-group select {
            height: 56px;
            font-weight: normal;
            font-size: 16px !important;
            border: 1px solid #D8D8DC;
            border-radius: 8px;
            display: flex;
            -webkit-box-align: center;
            padding: 0px 15px;
            width: 100%;
            outline: none;
            color: #808080;
        }
    </style>
</head>
<body>
    <div class="main-table-data PetAppointment">
        <form class="form-row" enctype="multipart/form-data">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Pharmacy</h5>
                    </div>
                    @*<div class="col-md-3">
                            &nbsp;
                        </div>*@
                    <div class="col-md-2" style="text-align:right">
                        <div class="form-group">
                            <button type="button" class="btn" style=" padding: 6px 7px; width: 100%; font-weight: 400; font-size: 14px; color: black; border: 1px solid #D8D8DC;background-color:white;" data-toggle="modal" data-target="#ReIssuePharmacy">
                                Re-Issue Pharmacy
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2" style="text-align:right">
                        <div class="form-group">
                            <button type="button" class="btn" style="padding: 6px 7px; width: 100%; font-weight: 400; font-size: 14px; color: black; border: 1px solid #D8D8DC; background-color: white; " data-toggle="modal" data-target="#DispensePharmacy">
                                Dispense Pharmacy
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2" style="text-align:right">
                        <div class="form-group">
                            <button type="button" class="btn btn-primary" data-toggle="modal" style="background: #652B88; width: 100%; padding: 6px 7px;width:100%;" data-target="#NewPharmacy">
                                +New Request
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <br /><br />
            <div class="col-md-12 main-table">
                <table class="table" style="width:100%">
                    <thead>
                        <tr style="background: #F5F5FA !important;">
                            <th>Index</th>
                            <th>Pharmacy ID</th>
                            <th>Pet Parent Name</th>
                            <th>Prescription Date</th>
                            <th>Pet Name</th>
                            <th>Appointment Type</th>
                            <th>Pharmacy</th>
                            <th>Quantity(Pcs.)</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody class="tbodyData"></tbody>
                </table>
            </div>

            <!--  <div class="col-md-12 main-table">
                <table class="table" style="width:100%">
                    <thead>
                        <tr style="background: #F5F5FA !important;">
                            <th>Index</th>
                            <th>Pharmacy ID</th>
                            <th>Pet Parent Name</th>
                            <th>Prescription Date</th>
                            <th>Pet Name</th>
                            <th>Appointment Type</th>
                            <th>Pharmacy</th>
                            <th>Quantity(Pcs.)</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody class="tbodyData"></tbody>
                </table>
            </div>-->

            <div class="modal fade" id="NewPharmacy" tabindex="-1" aria-labelledby="NewPharmacyRequestlabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="NewPharmacyRequestlabel">New Pharmacy Request</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="col-md-12">
                                <div class="row">
                                    <input type="hidden" id="NewpharmacyId" asp-for="NewPharmacy_id" />
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Pet Parent Id <span class="span-star">*</span></label>
                                            <select id="ddlPetParent" asp-for="PetParent_Id" style="width:100%">
                                                @*<option value="">Select Pet Parent Id</option>*@
                                                @if (ViewBag.petParentName != null)
                                                {
                                                    foreach (var item in ViewBag.petParentName as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pet's Name </label>
                                            <select id="ddlPetName" asp-for="Pet_id" style="width:100%">
                                                <option value="">Select Pet Name</option>
                                                @if (ViewBag.Pet != null)
                                                {
                                                    foreach (var item in ViewBag.Pet as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>
                                            @*<input type="text" id="txtPetName" asp-for="PetName" class="inputText" placeholder="Pet's Name" />*@
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Appointment Type</label>
                                            <input type="hidden" id="txtAppTypeId" asp-for="Appointment_type" />
                                            <input type="text" id="txtAppTypename" readonly asp-for="Appointment_type_name" placeholder="Appointment Type" />
                                            @*<select id="ddlAppType" asp-for="Appointment_type" disabled>
            <option value="">Select Appointment Type</option>
            @if (ViewBag.AppointmentType != null)
            {
                foreach (var item in ViewBag.AppointmentType as List<SelectListItem>)
                {
                    <option value="@item.Value">@item.Text</option>
                }
            }
        </select>*@
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pharmacy <span class="span-star">*</span></label>
                                            <input type="text" id="txtPharmacy" placeholder="Pharmacy Name" asp-for="Pharmacy_name" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Prescription Date <span class="span-star">*</span></label>
                                            <input type="date" id="txtpresDate" asp-for="Prescription_Date" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Prescription <span class="span-star">*</span></label>
                                            <textarea rows="3" id="txtPrescription" asp-for="Prescription" placeholder="Prescription"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Quantitiy Requested</label>
                                            <input type="text" id="txtQuantitiy" asp-for="Quantity" placeholder="Quantity Requested" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Refills</label>
                                            <input type="text" id="txtRefills" asp-for="Refills" placeholder="Refills" />
                                        </div>
                                    </div>
                                    <div class="col-md-2 offset-7">
                                        <input type="button" value="CLEAR" style="padding: 6px 11px; color: black; font-size: 14px; width: 100%; height: 34px; text-align: center; border: 1px solid #D8D8DC; border-radius: 8px; background-color: #efefef; " class="btn" id="btnClear" />
                                    </div>
                                    <div class="col-md-3">
                                        <input type="submit" style="background: #652B88; border-radius: 7px; border: none; padding: 9px; padding: 6px 3px; color: white; font-size: 14px; width: -webkit-fill-available; margin-bottom: 20px;" value="+Create Request" class="btn btn-primary" id="btnSave" asp-action="CreateNewPharmacy" asp-controller="Patients" formmethod="post" onclick="return ValidationNewPharmacy();" />
                                    </div>
                                    @if (ViewBag.Message != null)
                                    {
                                        <script type="text/javascript">
                                            window.onload = function () {
                                             alert("@ViewBag.Message");
                                        };
                                        </script>
                                    }
                                </div>
                            </div>
                        </div>
                        @*<div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Save changes</button>
                            </div>*@
                    </div>
                </div>
            </div>

            <div class="modal fade" id="DispensePharmacy" tabindex="-1" aria-labelledby="DispensePharmacylabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="DispensePharmacylabel">Dispense Pharmacy Request</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="col-md-12">
                                <div class="row">
                                    <input type="hidden" id="NewpharmacyId" asp-for="NewPharmacy_id" />
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Pet Parent Id <span class="span-star">*</span></label>
                                            <select id="ddlPetParentDispense" asp-for="PetParent_Id" style="width:100%">
                                                @*<option value="">Select Pet Parent Id</option>*@
                                                @if (ViewBag.petParentName != null)
                                                {
                                                    foreach (var item in ViewBag.petParentName as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pet Name</label>
                                            <select id="ddlPatientName" style="width:100%">
                                                <option value="">Select Pet Name</option>
                                                @if (ViewBag.Pet != null)
                                                {
                                                    foreach (var item in ViewBag.Pet as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Appointment Type</label>
                                            <input type="hidden" id="hidDisAppType" asp-for="Appointment_type" />
                                            <input type="text" id="txtDisAppType" placeholder="Appointment Type" readonly asp-for="Appointment_type_name" />
                                            @*<select id="DispenseddlAppType" asp-for="Appointment_type">
                                                <option value="">Select Appointment Type</option>
                                                @if (ViewBag.AppointmentType != null)
                                                {
                                                    foreach (var item in ViewBag.AppointmentType as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>*@
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pharmacy </label>
                                            <input type="text" id="txtDispensePharmacy" readonly placeholder="Pharmacy Name" asp-for="Pharmacy_name" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Prescription Date</label>
                                            <input type="date" id="txtDispensepresDate" readonly asp-for="Prescription_Date" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Prescription</label>
                                            <textarea rows="3" id="txtDispensePrescription" readonly asp-for="Prescription" placeholder="Prescription"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Quantitiy Requested</label>
                                            <input type="text" id="txtDispenseQuantitiy" readonly asp-for="Quantity" placeholder="Quantity Requested" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Refills</label>
                                            <input type="text" id="txtDispenseRefills" readonly asp-for="Refills" placeholder="Refills" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Bill To <span class="span-star">*</span></label>
                                            <input type="text" placeholder="Bill To" id="txtDispenseBillTo" asp-for="Bill_To" />
                                        </div>
                                    </div>
                                    <div class="col-md-2 offset-6">
                                        <input type="submit" style="padding: 6px 11px; color: black; font-size: 14px; width: 100%; height: 34px; text-align: center; border: 1px solid #D8D8DC; border-radius: 8px; background-color: #efefef; " value="Cancel" class="btn btn-warning" asp-controller="Patients" asp-action="Pharmacy" formmethod="post" id="btnClear" />
                                    </div>
                                    <div class="col-md-4">
                                        <input type="button" style=" background: #652B88; border-radius: 7px; border: none; padding: 9px; padding: 6px 3px; color: white; font-size: 14px; width: -webkit-fill-available; margin-bottom: 20px;" value="Dispense Pharmacy" class="btn btn-primary" id="btnDispenseSave" onclick="SendPatientData()" />
                                    </div>
                                    @if (ViewBag.Message != null)
                                    {
                                        <script type="text/javascript">
                                            window.onload = function () {
                                             alert("@ViewBag.Message");
                                        };
                                        </script>
                                    }
                                </div>
                            </div>
                        </div>
                        @*<div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Save changes</button>
                            </div>*@
                    </div>
                </div>
            </div>

            <div class="modal fade" id="ReIssuePharmacy" tabindex="-1" aria-labelledby="ReIssuePharmacyLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ReIssuePharmacyLabel">Re-Issue Pharmacy</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="col-md-12">
                                <div class="row">
                                    <input type="hidden" id="NewpharmacyId" asp-for="NewPharmacy_id" />
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Pet Parent Id <span class="span-star">*</span></label>
                                            <select id="ddlReIssuePetParent" asp-for="PetParent_Id" style="width:100%">
                                                @*<option value="">Select Pet Parent Id</option>*@
                                                @*@if (ViewBag.petParentName != null)
                                                    {
                                                        foreach (var item in ViewBag.petParentName as List<SelectListItem>)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }*@
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pet's Name</label>
                                            <select id="ddlReIssuePetName" asp-for="Pet_id" onchange="ReIssueGetPatientData()" style="width:100%">
                                                <option value="">Select Pet Name</option>
                                                @*@if (ViewBag.Pet != null)
                                                    {
                                                        foreach (var item in ViewBag.Pet as List<SelectListItem>)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }*@
                                            </select>
                                            @*<input type="text" id="txtPetName" asp-for="PetName" class="inputText" placeholder="Pet's Name" />*@
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Appointment Type</label>
                                            <input type="hidden" id="hidReIssueApptye" asp-for="Appointment_type" />
                                            <input type="text" id="txtReIssueApptye" asp-for="Appointment_type_name" readonly placeholder="Appointment Type" />
                                            @*<select id="ddlReIssueAppType" asp-for="Appointment_type" >
                                                <option value="">Select Appointment Type</option>
                                                @if (ViewBag.AppointmentType != null)
                                                {
                                                    foreach (var item in ViewBag.AppointmentType as List<SelectListItem>)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            </select>*@
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Pharmacy</label>
                                            <input type="text" id="txtReIssuePharmacy" placeholder="Pharmacy Name" asp-for="Pharmacy_name" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Quantity To Return</label>
                                            <input type="text" id="txtQuyantityReturn" asp-for="Quantity_ToReturn" placeholder="Quantity" />
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Return Reason/Notes</label>
                                            <textarea rows="3" id="txtreturnReason" asp-for="Return_Reason" placeholder="Return Reason"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Return Location</label>
                                            <textarea rows="3" id="txtReturnLocation" asp-for="Return_Location" placeholder="Return Location"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Adjustment Date</label>
                                            <input type="date" id="txtAdjDate" asp-for="Adjustment_Date" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Credit To Account <span class="span-star">*</span></label>
                                            <input type="text" id="txtCreditAC" asp-for="Credit_ToAccount" placeholder="Credit To Account" />
                                        </div>
                                    </div>
                                    <div class="col-md-2 offset-6">
                                        <input type="submit" value="Cancel" style="padding: 6px 11px; color: black; font-size: 14px; width: 100%; height: 34px; text-align: center; border: 1px solid #D8D8DC; border-radius: 8px; background-color: #efefef;" class="btn" id="btnClear" asp-controller="Patients" asp-action="Pharmacy" formmethod="post" />
                                    </div>
                                    <div class="col-md-4">
                                        <input type="button" value="Re-Issue Pharmacy" style="background: #652B88; border-radius: 7px; border: none; padding: 9px; padding: 6px 15px; color: white; font-size: 14px; width: -webkit-fill-available; margin-bottom: 20px;" class="btn" id="btnSave" onclick="ReIssuePharmacyDataSave()" />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <h6 class="text-success">@ViewData["msg"]</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @*<div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Save changes</button>
                            </div>*@
                    </div>
                </div>
            </div>
        </form>
    </div>
    @*<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>*@


    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script>
        $("#ddlPatientName").change(function () {
            GetPatientData();
        });
        function ShowDataInTable() {
            var item;
            $.ajax({
                url: "/Patients/ShowPharmacyDetails",
                data: JSON.stringify(item),
                dataType: 'JSON',
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    var html = '';
                    var index = 1;
                    $.each(data, function (key, item) {
                        html += '<tr>';
                        // html += '<td>' + index + '</td>';
                        html += '<td>' + item.newPharmacy_id + '</td>';
                        html += '<td>' + item.petParent_Id + '</td>';
                        html += '<td>' + item.prescription_Date + '</td>';
                        html += '<td>' + item.pet_id + '</td>';
                        html += '<td>' + item.appointment_type + '</td>';
                        html += '<td>' + item.pharmacy_name + '</td>';
                        html += '<td>' + item.quantity + '</td>';
                        html += '<td><a class="btn btn-sm" href="#" onclick="return Editbyid(' + item.newPharmacy_id + ')" data-toggle="modal" data-target="#NewPharmacy" ><i class="fa fa-edit"></i></a></td>';
                        html += '<td><a class="btn btn-sm" href="#" onclick="return DeletePharmacybyId(' + item.newPharmacy_id + ')"><i class="fa fa-trash-o"></i></a></td>';
                        html += '</tr>';
                        index++;
                    });
                    $('.tbodyData').html(html);
                }
            });
        }
        function DeletePharmacybyId(newPharmacy_id) {
            var checkstr = confirm('Are You Sure You Want To Delete This?');
            var PetObj = JSON.stringify({ pharmacyId: newPharmacy_id });
            // var item;
            if (checkstr == true) {
                $.ajax({
                    url: "/Patients/DeletePharmacyById",
                    data: JSON.parse(PetObj),
                    dataType: 'JSON',
                    type: 'POST',
                    //contentType: 'application/json; charset=utf-8',
                    success: function (result) {
                        if (result.msg == "Delete Successfull!!") {
                            alert("Delete Success");
                            ShowDataInTable();
                        }
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                    }
                });
            }
            else {
                return false;
            }
        }
        function Editbyid(newPharmacy_id) {
            // var checkstr = confirm('Are You Sure You Want To Delete This?');
            var PetObj = JSON.stringify({ pharmacyId: newPharmacy_id });
            // var item;

            $.ajax({
                url: "/Patients/EditPharmacyById",
                data: JSON.parse(PetObj),
                dataType: 'JSON',
                type: 'POST',
                //contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    $('#btnSave').text = "UPDATE";
                    $('#NewpharmacyId').val(result.newPharmacy_id);
                    $('#txtPatient').val(result.patient_name);
                    //$('#ddlAppType').val(result.appointment_type);
                    $('#txtAppTypeId').val(result.appointment_type);
                    $('#txtAppTypename').val(result.appointment_type_name);
                    $('#txtPharmacy').val(result.pharmacy_name);
                    $('#txtpresDate').val(result.prescription_Date);
                    $('#txtPrescription').val(result.prescription);
                    $('#txtQuantitiy').val(result.quantity);
                    $('#txtRefills').val(result.refills);

                    ShowDataInTable();
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
        function GetPatientData() {
            var selected_val = $('#ddlPatientName').find(":selected").attr('value');
            $.ajax({  //ajax call
                type: "GET",      //method == GET
                url: "/Patients/GetPatientDetails", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (result) {
                    //$('#GrpHead').val(data); // here we will set a value of text box
                    $('#NewpharmacyId').val(result.newPharmacy_id);
                    //$('#txtPatient').val(result.patient_name);
                    //$('#DispenseddlAppType').val(result.appointment_type);
                    $('#hidDisAppType').val(result.appointment_type);
                    $('#txtDisAppType').val(result.appointment_type_name);
                    $('#txtDispensePharmacy').val(result.pharmacy_name);
                    $('#txtDispensepresDate').val(result.prescription_Date);
                    $('#txtDispensePrescription').val(result.prescription);
                    $('#txtDispenseQuantitiy').val(result.quantity);
                    $('#txtDispenseRefills').val(result.refills);
                },
                error: function () {
                    alert("Data not Found !!");
                }
            });
        }
        function SendPatientData() {
            var message = ValidationDispensePharmacy();
            if (message != "") {
                //var obj = {};
                id = $('#NewpharmacyId').val();
                //alert(id);
                appointmentType = $('#DispenseddlAppType').val();
                pharmacyname = $('#txtDispensePharmacy').val();
                PrescriptionDate = $('#txtDispensepresDate').val();
                prescription = $('#txtDispensePrescription').val();
                quantitiy = $('#txtDispenseQuantitiy').val();
                refills = $('#txtDispenseRefills').val();
                billTo = $('#txtDispenseBillTo').val();
                $.ajax({
                    url: "/Patients/SaveDispensePharmacy",
                    type: 'POST',
                    data: { id: id, appointmentType: appointmentType, pharmacyname: pharmacyname, PrescriptionDate: PrescriptionDate, prescription: prescription, quantitiy: quantitiy, refills: refills, billTo: billTo },
                    dataType: 'JSON',
                    //data: JSON.stringify(obj),
                    success: function (result) {
                        if (result.msg == "Success") {
                            alert("Dispense pharmacy added successfully.");
                            DispenseClear();
                        }
                        else {
                            alert("Dispense pharmacy not added.");
                            DispenseClear();
                        }
                    },
                    error: function () {
                        alert("Data Not Found");
                    }
                });
            }
            else {
                alert(message);
            }
        }
        function DispenseClear() {
            $('#NewpharmacyId').val("");
            $('#ddlPatientName').val("");
            $('#DispenseddlAppType').val("");
            $('#txtDispensePharmacy').val("");
            $('#txtDispensepresDate').val("");
            $('#txtDispensePrescription').val("");
            $('#txtDispenseQuantitiy').val("");
            $('#txtDispenseRefills').val("");
            $('#txtDispenseBillTo').val("");
        }
        function ReIssueGetPatientData() {
            var selected_val = $('#ddlReIssuePetName').find(":selected").attr('value');
            $.ajax({  //ajax call
                type: "GET",      //method == POST
                url: "/Patients/GetPatientDetails", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (result) {
                    //$('#GrpHead').val(data); // here we will set a value of text box
                    $('#NewpharmacyId').val(result.newPharmacy_id);
                    //$('#txtPatient').val(result.patient_name);
                    //$('#ddlReIssueAppType').val(result.appointment_type);
                    $('#hidReIssueApptye').val(result.appointment_type);
                    $('#txtReIssueApptye').val(result.appointment_type_name);;
                    $('#txtReIssuePharmacy').val(result.pharmacy_name);
                    //$('#txtDispensepresDate').val(result.prescription_Date);
                    //$('#txtDispensePrescription').val(result.prescription);
                    //$('#txtDispenseQuantitiy').val(result.quantity);
                    //$('#txtDispenseRefills').val(result.refills);
                },
                error: function () {
                    alert("Data Not Found !!");
                }
            });
        }
        function ReIssuePharmacyDataSave() {
            id = $('#NewpharmacyId').val();
            appointmentType = $('#ddlReIssueAppType').val();
            pharmacyname = $('#txtReIssuePharmacy').val();
            QuantityToReturn = $('#txtQuyantityReturn').val();
            ReturnReason = $('#txtreturnReason').val();
            ReturnLocation = $('#txtReturnLocation').val();
            AdjustmentDate = $('#txtAdjDate').val();
            CreditToAccount = $('#txtCreditAC').val();
            $.ajax({
                url: "/Patients/ReIssuePharmacySave",
                type: 'POST',
                data: { id: id, appointmentType: appointmentType, pharmacyname: pharmacyname, QuantityToReturn: QuantityToReturn, ReturnReason: ReturnReason, ReturnLocation: ReturnLocation, AdjustmentDate: AdjustmentDate, CreditToAccount: CreditToAccount },
                dataType: 'JSON',
                //data: JSON.stringify(obj),
                success: function (result) {
                    if (result.msg == "Success") {
                        alert("Re-Issue pharmacy added successfully.");
                        ReIssuePharmacyClear();
                    }
                    else {
                        alert("Re-Issue pharmacy Not added");
                        ReIssuePharmacyClear();
                    }
                },
                error: function () {
                    alert(errormessage.responseText);
                }
            });
        }
        function ReIssuePharmacyClear() {
            $('#NewpharmacyId').val("").hide;
            $('#ddlReIssuePetName').val("");
            $('#ddlReIssueAppType').val("");
            $('#txtReIssuePharmacy').val("");
            $('#txtDispensePharmacy').val("");
            $('#txtQuyantityReturn').val("");
            $('#txtreturnReason').val("");
            $('#txtReturnLocation').val("");
            $('#txtAdjDate').val("");
            $('#txtCreditAC').val("");
        }
        function ValidationNewPharmacy() {
            var msg = "";
            if ($('#txtPatient').val() == "") { msg = "Patient can not left Blank !! \n"; }
            // if ($('#ddlAppType').val() == "") { msg += "Appointment Type can not left Blank !! \n"; }
            if ($('#txtPharmacy').val() == "") { msg += "Pharmacy can not left Blank !! \n"; }
            if ($('#txtpresDate').val() == "") { msg += "Prescription Date can not left Blank !! \n"; }
            if ($('#txtQuantitiy').val() == "") { msg += "Quantity Requested can not left Blank !! \n"; }
            if (msg != "") { alert(msg); return false; }
        }
        function ValidationDispensePharmacy() {
            var msg = "";
            if ($('#ddlPatientName').val() == "") { msg = "Patient can not left Blank !! \n"; }
            //if ($('#DispenseddlAppType').val() == "") { msg += "Appointment Type can not left Blank !! \n"; }
            if ($('#txtDispensePharmacy').val() == "") { msg += "Pharmacy can not left Blank !! \n"; }
            if ($('#txtDispensepresDate').val() == "") { msg += "Prescription Date can not left Blank !! \n"; }
            if ($('#txtDispenseQuantitiy').val() == "") { msg += "Quantity Requested can not left Blank !! \n"; }
            if (msg != "") { alert(msg); return false; }
        }
        function GetAppointmentType() {
            var selected_val = $('#ddlPetName').find(":selected").attr('value');
            $.ajax({  //ajax call
                type: "GET",      //method == GET
                url: "/Patients/GetAppointmentType", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (result) {
                   // $('#ddlAppType').val(result.appointment_type);
                    $('#txtAppTypeId').val(result.appointment_type);
                    $('#txtAppTypename').val(result.appointment_type_name)
                },
                error: function (errormessage) {
                    alert("Data Not Found !!");
                }
            });
        }
        $("#ddlPetParent").change(function () {
            GetPetData();
        });
        $("#ddlPetName").change(function () {
            GetAppointmentType();
        });
        $("#ddlPetParentDispense").change(function () {
            GetPetDispenseData();
        });
        $("#ddlReIssuePetParent").change(function () {
            GetPetDataReIssue();
        });
        function GetPetData() {
            var selected_val = $('#ddlPetParent').find(":selected").attr('value');
            $("#ddlPetName").prop("disabled", true);
            $.ajax({  //ajax call
                type: "GET",      //method == GET
                url: "/Patients/GetPetFromParentId", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (json, result) {
                    $("#ddlPetName").empty();
                    json = json || {};
                    for (var i = 0; i < json.length; i++) {
                        $("#ddlPetName").append('<option value="' + json[i].petId + '">' + json[i].petName + '</option>');
                    }
                    GetAppointmentType();
                    $("#ddlPetName").prop("disabled", false);
                },
                error: function () {
                    alert("Data Not Found");
                }
            });
        }
        function PopulatePetParentId() {
            $.ajax({
                type: "GET",
                url: "/Patients/PopulatePetParentName",
                datatype: "Json",
                data: {},
                // async: false,
                success: function (data) {
                    $('#ddlPetParent').html('<option value="0">Select Pet Parent Id</option>');
                    var PetParentId = '';
                    for (var i = 0; i < data.length; i++) {
                        PetParentId += '<option value="' + data[i].value + '">' + data[i].text + '</option>';
                    }
                    $('#ddlPetParent').append(PetParentId);
                }
            });
        }
        function EditPetName(petParent_Id) {
            var PetObj = JSON.stringify({ petParent_Id: petParent_Id });
            $.ajax({
                type: "GET",
                url: "/Patients/EditPetName",
                datatype: "Json",
                data: JSON.parse(PetObj),
                // async: false,
                success: function (result) {
                    $('#ddlPetName').html('<option value="0">Select Pet Name</option>');
                    PetName = '';
                    for (var i = 0; i < result.length; i++) {
                        PetName += '<option value="' + result[i].value + '">' + result[i].text + '</option>';
                    }
                    $('#ddlPetName').append(PetName);
                    $('#ddlPetName').val().attr("selected", "true");
                }
            });
        }
        function PopulateddlPetParentDispense() {
            $.ajax({
                type: "GET",
                url: "/Patients/PopulatePetParentName",
                datatype: "Json",
                data: {},
                // async: false,
                success: function (data) {
                    $('#ddlPetParentDispense').html('<option value="0">Select Pet Parent Id</option>');
                    var PetParentId = '';
                    for (var i = 0; i < data.length; i++) {
                        PetParentId += '<option value="' + data[i].value + '">' + data[i].text + '</option>';
                    }
                    $('#ddlPetParentDispense').append(PetParentId);
                }
            });
        }
        function GetPetDispenseData() {
            var selected_val = $('#ddlPetParentDispense').find(":selected").attr('value');
            $("#ddlPatientName").prop("disabled", true);
            $.ajax({  //ajax call
                type: "GET",      //method == GET
                url: "/Patients/GetPetFromParentId", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (json, result) {
                    $("#ddlPatientName").empty();
                    json = json || {};
                    for (var i = 0; i < json.length; i++) {
                        $("#ddlPatientName").append('<option value="' + json[i].petId + '">' + json[i].petName + '</option>');
                    }
                    GetPatientData();
                    $("#ddlPatientName").prop("disabled", false);
                },
                error: function () {
                    alert("Data Not Found");
                }
            });
        }
        function PopulateDdlReIssuePetParent() {
            $.ajax({
                type: "GET",
                url: "/Patients/PopulatePetParentName",
                datatype: "Json",
                data: {},
                // async: false,
                success: function (data) {
                    $('#ddlReIssuePetParent').html('<option value="0">Select Pet Parent Id</option>');
                    var PetParentId = '';
                    for (var i = 0; i < data.length; i++) {
                        PetParentId += '<option value="' + data[i].value + '">' + data[i].text + '</option>';
                    }
                    $('#ddlReIssuePetParent').append(PetParentId);
                }
            });
        }
        function GetPetDataReIssue() {
            var selected_val = $('#ddlReIssuePetParent').find(":selected").attr('value');
            $("#ddlReIssuePetName").prop("disabled", true);
            $.ajax({  //ajax call
                type: "GET",      //method == GET
                url: "/Patients/GetPetFromParentId", //url to be called
                data: "id=" + selected_val, //data to be send
                success: function (json, result) {
                    $("#ddlReIssuePetName").empty();
                    json = json || {};
                    for (var i = 0; i < json.length; i++) {
                        $("#ddlReIssuePetName").append('<option value="' + json[i].petId + '">' + json[i].petName + '</option>');
                    }
                    ReIssueGetPatientData();
                    $("#ddlReIssuePetName").prop("disabled", false);
                },
                error: function () {
                    alert("Data Not Found");
                }
            });
        }
        ShowDataInTable();
        PopulatePetParentId();
        PopulateddlPetParentDispense();
        PopulateDdlReIssuePetParent();
    </script>
    <script>
        //function ShowDataInTable() {
        //    var item;
        //    $.ajax({
        //        url: "/Patients/CheckInRequestForPharmacy",
        //        data: JSON.stringify(item),
        //        dataType: 'JSON',
        //        type: 'GET',
        //        contentType: 'application/json; charset=utf-8',
        //        success: function (data) {
        //            var html = '';
        //            var index = 1;
        //            $.each(data, function (key, item) {
        //                html += '<tr>';
        //                // html += '<td>' + index + '</td>';
        //                // html += '<td>' + item.newPharmacy_id + '</td>';
        //                html += '<td>' + item.petS_ParentName + '</td>';
        //                html += '<td>' + item.prescription_Date + '</td>';
        //                html += '<td>' + item.petName + '</td>';
        //                html += '<td>' + item.appointment_Type + '</td>';
        //                html += '<td>' + item.medication + '</td>';
        //                html += '<td>' + item.quantity + '</td>';
        //                html += '<td><a class="btn btn-sm" href="#" onclick="return Editbyid(' + item.newPharmacy_id + ')" data-toggle="modal" data-target="#NewPharmacy" ><i class="fa fa-edit"></i></a></td>';
        //                html += '<td><a class="btn btn-sm" href="#" onclick="return DeletePharmacybyId(' + item.newPharmacy_id + ')"><i class="fa fa-trash-o"></i></a></td>';
        //                html += '</tr>';
        //                index++;
        //            });
        //            $('.tbodyData').html(html);
        //        }
        //    });
        //}

    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#ddlPetParent").select2({
                dropdownParent: $("#NewPharmacy")
            });
            $("#ddlPetName").select2({
                dropdownParent: $("#NewPharmacy")
            });
            $('#ddlPetParentDispense').select2({
                dropdownParent: $("#DispensePharmacy")
            });
            $('#ddlPatientName').select2({
                dropdownParent: $("#DispensePharmacy")
            });
            $('#ddlReIssuePetParent').select2({
                dropdownParent: $("#ReIssuePharmacy")
            });
            $('#ddlReIssuePetName').select2({
                dropdownParent: $("#ReIssuePharmacy")
            });
        });
    </script>
</body>
</html>

